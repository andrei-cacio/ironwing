/*! Mjs 0.0.1 12-11-2014 */
function M(a,b,c){"use strict";this.init(a,b,c)}"object"==typeof module?module.exports=M:"function"==typeof define&&define.amd&&define(function(){"use strict";return M}),function(){"use strict";var a=[];M.prototype.init=function(b,c,d){var e=this,f=[];if(this.address=c?b+"/"+c:b,this.type=b,void 0===M.adapter)throw"No adapter found";if(this._getAPIWithoutSerializer=function(){return M.adapter.getAPIURL()+this.type+"/"+this.attr.id},d?(this.attr=d,this.attr.id||(this.attr.id=c)):M.adapter.onDone(function(a){a.length?a.forEach(function(a){f.push(new M(b,a.id,a))}):e.attr=a}).onFail(function(){throw"\nGET HTTP request failed for the resource: ["+e.type+"]. \n"}).ajax("get",this.address,!1),f.length)return f;var g=M.find(this.type,this.attr.id);return g?g.attr=this.attr:a.push(this),1},M.useAdapter=function(a,b){var c;M.adapters&&M.adapters.hasOwnProperty(a)&&(c=M.adapters[a],c.init.apply(c,b),M.adapter=c)},M.prototype.update=function(b){var c=this,d=this.type,e=this._adapter;M.adapter.onDone(function(b){a.forEach(function(a){a.type===d&&a._adapter===e&&(a.attr=b)})}).onFail(function(){throw"A problem has accoured while trying to update the ["+d+"] model"}).ajax("put",this.address,!1,c.attr),b&&b()},M.prototype.get=function(a){var b=this;M.adapter.onDone(function(a){b.attr=a}).ajax("get",this.address,!1),a&&a()},M.prototype.delete=function(b){var c=this;M.adapter("delete",this._getAPIWithoutSerializer(),!1),b&&b(),a=a.filter(function(a){return a.attr.id!==c.attr.id}),this.attr={}},M.create=function(a,b){var c;if(M.adapter.onDone(function(a){c=a}).ajax("post",a,!1,{attr:b}),!c)throw"A problem has accoured while trying to create a ["+this.type+"] model";return new this(a,c.id,c)},M.find=function(b,c){var d;return a.forEach(function(a){a.type===b&&a.attr.id===c&&(d=a)}),d},M.findAll=function(b){return a.filter(function(a){return a.type===b})}}(),function(a){"use strict";function b(){this.xhr=new XMLHttpRequest,this.appUrl=null,this.done=null,this.fail=null}function c(a){return"string"!=typeof a?"/":("/"!==a[a.length-1]&&(a+="/"),"/"!==a[0]&&(a="/"+a),a)}b.prototype.init=function(a){var b=this;this.apiUrl=c(a),this.done=null,this.fail=null,this.xhr.onreadystatechange=function(){var a;4===b.xhr.readyState&&200===b.xhr.status&&"function"==typeof b.done?(a=JSON.parse(b.xhr.responseText),b.done.call(null,a)):4===b.xhr.readyState&&404===b.xhr.status&&"function"==typeof b.fail&&b.fail.call(null)}},b.prototype.getAPIURL=function(){return this.apiUrl},b.prototype.onDone=function(a){return this.done=a,this},b.prototype.onFail=function(a){return this.fail=a,this},b.prototype.ajax=function(a,b,c,d){a=a.toUpperCase(),this.xhr.open(a,this.apiUrl+b,c),"POST"===a||"PUT"===a?(this.xhr.setRequestHeader("Content-Type","application/json;charset=UTF-8"),this.xhr.send(JSON.stringify(d))):this.xhr.send()},a.adapters=a.adapters||{},a.adapters.JSON=new b}(M);